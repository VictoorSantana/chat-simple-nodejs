<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/custom.css">
</head>

<body>

    <style>
        .scrollbar-chats {
            scrollbar-width: auto;
            scrollbar-color: #4d4d4d #e6e6e6;
        }

        .scrollbar-chats::-webkit-scrollbar {
            width: 5px;
        }

        .scrollbar-chats::-webkit-scrollbar-track {
            background: #e6e6e6;
        }

        .scrollbar-chats::-webkit-scrollbar-thumb {
            background-color: #4d4d4d;
            border-radius: 0px;
            border: 3px none #ffffff;
        }
    </style>


    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <div class="bg-dark py-2 px-1 w-100" id="sidebar-friends" style="display: none;min-height: 100vh;">

                    <div class="mb-2">
                        <div class="d-flex align-items-center mb-1">
                            <button type="button" class="btn btn-dark" id="btn-go-back-friends">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <h4 class="text-white d-inline-block m-0"> Amigos(a) </h4>
                        </div>
                        <p class="text-secondary"> Solicitações de amizades também ficam presentes aqui </p>
                    </div>

                    <div class="position-relative mb-2">
                        <div class="text-light position-absolute" style="left: 13px;top: 10px;">
                            <i class="fas fa-search"></i>
                        </div>
                        <input type="text" placeholder="Procurar por conversas"
                            class="form-control pl-5 bg-dark text-white border-light border-top-0 border-left-0 border-right-0">
                    </div>


                    <div id="friends-container"></div>

                </div>
                <div class="bg-dark py-2 px-1 w-100" id="sidebar-default" style="display: block;min-height: 100vh;">
                    <div class="d-flex justify-content-between align-items-center w-100 mb-1">
                        <div class="d-flex align-items-center">
                            <img src="https://via.placeholder.com/150x150" style="width:60px;height:60px"
                                class="d-inline-block rounded-circle me-photo" alt="myuser">
                            <p id="me-name" class="text-white my-0 ml-2"> Lorem ipsum </p>
                        </div>
                        <div>
                            <div class="position-relative d-inline-block" id="friend-request-container">
                                <button type="button" class="btn btn-link text-white" id="btn-friends">
                                    <i class="fas fa-users"></i>
                                </button>
                            </div>

                            <div class="btn-group dropleft">
                                <button type="button" class="btn btn-link text-white dropdown-toggle"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <div class="dropdown-menu">
                                    <a href="/novo-amigo.html" class="btn btn-link btn-block text-left">Novo
                                        amigo(a)</a>

                                    <button type="button" id="btn-disconnect" class="btn btn-link btn-block text-left">
                                        Desconectar e sair
                                    </button>

                                </div>
                            </div>


                        </div>
                    </div>

                    <div class="position-relative mb-2">
                        <div class="text-light position-absolute" style="left: 13px;top: 10px;">
                            <i class="fas fa-search"></i>
                        </div>
                        <input type="text" placeholder="Procurar por conversas"
                            class="form-control pl-5 bg-dark text-white border-light border-top-0 border-left-0 border-right-0">

                    </div>

                    <div class="d-inline-block w-100 scrollbar-chats overflow-y-auto"
                        style="height: calc(100vh - 134px);">
                        <span
                            class="btn btn-dark cursor-pointer position-relative btn-block text-left d-flex align-items-center p-1">
                            <img src="https://via.placeholder.com/75x75?text=User"
                                class="m-1 d-inline-block rounded-circle cursor-pointer mr-2"
                                style="width: 50px;height:50px" alt="12">
                            <div>
                                <p class="text-white m-0" style="font-weight: 400;">Rayssa</p>
                                <p class="text-white m-0 small" style="font-weight: 400;">Olá, tudo bem?</p>
                            </div>

                            <small class="opacity-50 text-secondary" style="position: absolute;right:5px;">11:50</small>
                        </span>

                        <span
                            class="btn btn-dark cursor-pointer position-relative btn-block text-left d-flex align-items-center p-1">
                            <img src="https://via.placeholder.com/75x75?text=User"
                                class="m-1 d-inline-block rounded-circle cursor-pointer mr-2"
                                style="width: 50px;height:50px" alt="12">
                            <div>
                                <p class="text-white m-0" style="font-weight: 400;">Rayssa</p>
                                <p class="text-white m-0 small opacity-50" style="font-weight: 400;">Olá, tudo bem?
                                </p>
                            </div>

                            <small class="opacity-50 text-secondary" style="position: absolute;right:5px;">11:50</small>
                        </span>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="bg-secondary border-bottom border-primary">
                    <div class="row py-2 align-items-center">
                        <div class="col-md-6 col-sm-8 col-8">
                            <div class="d-flex align-items-center">
                                <button type="button" class="btn btn-link text-dark d-block d-sm-none">
                                    <i class="fas fa-angle-left"></i>
                                </button>
                                <img src="https://via.placeholder.com/200x200?text=User"
                                    class="d-inline-block rounded-circle" style="width: 54px;height:54px" alt="user">
                                <p class="my-0 ml-2 display-6 font-weight-bold"> Lorem ipsum </p>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-5 col-4 text-right">
                            <button type="button" class="btn btn-link text-dark mr-1">
                                <i class="fas fa-search"></i>
                            </button>
                            <button type="button" class="btn btn-link text-dark mr-2">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="bg-secondary overflow-y-auto scrollbar-chats d-inline-block w-100 position-relative px-1 pt-5 pb-1"
                    style="height: calc(100vh - 138px)">

                    <small id="time-container" class="text-dark position-absolute py-2 mx-auto"
                        style="top: 0px;right:0px;left:0px;width:75px">26/04/2021</small>

                    <div class="d-block text-right">
                        <div class="bg-primary py-2 text-left pr-4 pl-2 d-inline-block"
                            style="border-radius: 7px 7px 0px 7px;max-width: 75%;">
                            <p class="text-white m-0"> Lorem ipsum dolor </p>
                        </div>
                        <small class="text-right d-block text-dark opacity-50">11:50</small>
                    </div>

                    <div class="d-block text-left">
                        <div class="bg-dark py-2 pr-4 pl-2 d-inline-block"
                            style="border-radius: 7px 7px 7px 0px;max-width: 75%;">
                            <p class="text-white m-0"> Lorem ipsum dolor </p>
                        </div>
                        <small class="text-left d-block text-dark opacity-50">11:50</small>
                    </div>

                    <div class="d-block text-right">
                        <div class="bg-primary py-2 text-left pr-4 pl-2 d-inline-block"
                            style="border-radius: 7px 7px 0px 7px;max-width: 75%;">
                            <p class="text-white m-0">
                                Como você está? Amei o seu tipo de perfil e acredito
                                que podemos nos dar muito bem
                            </p>
                        </div>
                        <small class="text-right d-block text-dark opacity-50">11:50</small>
                    </div>
                </div>
                <div class="w-100 d-flex align-items-center bg-secondary">
                    <img src="https://via.placeholder.com/75x75?text=User"
                        class="me-photo m-1 d-inline-block rounded-circle" style="width: 50px;height:50px" alt="12">

                    <div style="width: calc(100% - 172px)" class="d-inline-block">
                        <input type="text" id="message-input" placeholder="Digite uma mensagem"
                            class="form-control rounded-0 px-0 pt-1 bg-secondary text-dark border-dark border-top-0 border-left-0 border-right-0">
                    </div>


                    <div>
                        <button type="button" class="btn btn-link text-dark">
                            <i class="far fa-smile"></i>
                        </button>
                        <button type="button" id="btn-send" class="btn btn-primary">
                            <i class="fas fa-location-arrow"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>








</body>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"
    integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.0/axios.min.js"
    integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="/assets/scripts/general.js"></script>
<script src="/assets/scripts/components.js"></script>


<script>
    const user = getStorageUser();
    const token = getToken();


    function intanceButtons() {
        $('.btn-accept-new-friend').each(function () {
            $(this).click(function () {
                const key = $(this).attr('key');
                axios({
                    method: 'post',
                    url: `api/request-friend/reject-or-accept?id=${key}&accept=1`,
                    data: {},
                    headers: { "Authorization": `Bearer ${token}` }
                })
                    .then(result => {                        
                        updateFriendContainer();
                    })
                    .catch(ex => addMesage(ex.response.data));
            });
        })
    }

    function updateFriendContainer() {
        axios({
            method: 'get',
            url: '/api/friend',
            data: {},
            headers: { "Authorization": `Bearer ${token}` }
        })
            .then(response => {
                $('#friends-container').empty();

                const result = response.data;
                const comps = new Components();

                for (let i = 0; i < result.length; i++) {
                    const data = result[i];
                    if (data.request) {
                        $('#friends-container').append(
                            comps.newFriend(data.ref_id,
                                data.url_photo,
                                data.name,
                                'btn-reject-new-friend',
                                'btn-accept-new-friend',
                            )
                        );
                    } else {
                        $('#friends-container').append(
                            comps.friend(data.ref_id,
                                data.url_photo,
                                data.name,
                                'btn-start-room'
                            )
                        );
                    }
                }

                intanceButtons()
            })
            .catch(ex => console.log(ex.response.data));
    }

    function updateNewFriendMe() {
        axios({
            method: 'get',
            url: '/api/request-friend/count/to-me',
            data: {},
            headers: { "Authorization": `Bearer ${token}` }
        })
            .then(result => {
                if (result.data) {
                    if ($('#friend-request-container > span').length) {
                        $('#friend-request-container > span').text(result.data);
                    } else {
                        $('#friend-request-container')
                            .append(`
                        <span
                            style="width: 24px;height: 24px;left: -3px;bottom: -8px;"
                            class="position-absolute text-center bg-warning text-dark d-inline-block rounded-circle">${result.data}</span>
                        `);
                    }
                }
            })
            .catch(ex => console.log(ex.response.data));
    }

    function toggleSidebar() {
        $('#sidebar-default').toggle();
        $('#sidebar-friends').toggle();

        if ($(this).attr('id') === 'btn-friends') {
            updateFriendContainer()
        }
    }    

    $(document).ready(function () {
        $('#me-name').text(user.name);

        $('.me-photo').each(function () {
            $(this).attr('src', user.url_photo)
        });

        $('#btn-disconnect').click(clearAuth);

        $('#btn-friends, #btn-go-back-friends').click(toggleSidebar)

        updateNewFriendMe();



        intanceButtons();
    })
</script>

</html>